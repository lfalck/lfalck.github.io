{"componentChunkName":"component---src-templates-blog-post-js","path":"/logic-app-microsoft-graph-oauth/","result":{"data":{"markdownRemark":{"html":"<p>Using the Microsoft Graph REST API in a Logic App is a nice way of creating integrations that work with Azure Active Directory. There are instructions how to use the API with Active Directory OAuth Authentication <a href=\"https://docs.microsoft.com/en-us/graph/auth-v2-service\">here</a>, but they do not map directly to the built in authentication in Logic Apps, so i thought i would share what worked for me. This example queries the API for users but it should work with any Microsoft Graph query given the right permissions.</p>\n<h2>1. Register your application in the Azure portal</h2>\n<ol>\n<li>Login to the <a href=\"https://portal.azure.com\">Azure Portal</a> and go to Azure Active Directory. </li>\n<li>Go to <strong>App Registrations</strong> and click <strong>New registration</strong>.</li>\n<li>Enter a name and click register, leave other options as default.</li>\n<li>Click <strong>View API Permissions</strong>, then <strong>Add a permission</strong> .</li>\n<li>Choose <strong>Microsoft Graph</strong>, select <strong>Application permissions</strong> and add \"Directory.Read.All\".</li>\n<li>Go to <strong>Certificates &#x26; secrets</strong>, generate a new client secret and store the output somewhere secure.</li>\n<li>If you are an Azure Active Directory administrator, you can click <strong>Grant admin consent for (your organization)</strong> directly, otherwise you need to ask an admin to do it.</li>\n</ol>\n<h2>2. Use the application in your Logic App</h2>\n<p>In an HTTP action, use <a href=\"https://graph.microsoft.com/v1.0/users\">https://graph.microsoft.com/v1.0/users</a> as URI and enter the following values after selecting <strong>Active Directory OAuth</strong> under <strong>Authentication</strong> (Authority needs to be added by clicking \"Add new parameter\").</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Authority</strong></td>\n<td><a href=\"https://login.windows.net\">https://login.windows.net</a></td>\n</tr>\n<tr>\n<td><strong>Tenant</strong></td>\n<td>Directory ID from the Application Registration</td>\n</tr>\n<tr>\n<td><strong>Audience</strong></td>\n<td><a href=\"https://graph.microsoft.com/\">https://graph.microsoft.com/</a></td>\n</tr>\n<tr>\n<td><strong>Client ID</strong></td>\n<td>Application ID from the Application Registration</td>\n</tr>\n<tr>\n<td><strong>Secret</strong></td>\n<td>Client secret from the Application Registration</td>\n</tr>\n</tbody>\n</table>\n<p>Registration might take a moment, but the Logic App should then be able to fetch users from your Azure Active Directory.</p>\n<p>Thanks to <a href=\"http://mlogdberg.com\">Mattias LÃ¶gdberg</a> for the help and to <a href=\"https://stackoverflow.com/questions/42960959/authorization-identitynotfound-on-microsoft-graph-api-request/\">NBajanca on Stackoverflow</a> for pointing out that you need the <strong>Directory.Read.All</strong> and not <strong>User.Read.All</strong> permission to query users.</p>\n<p>That is all, have a good day!</p>\n<p><em>Updated 2019-12-09 to use <a href=\"https://docs.microsoft.com/en-us/azure/active-directory/develop/app-registrations-training-guide-for-app-registrations-legacy-users\">the new App registrations experience in the Azure portal</a>.</em></p>","frontmatter":{"title":"Logic Apps Active Directory OAuth Authentication for Microsoft Graph","canonicalURL":"https://lfalck.se/logic-app-microsoft-graph-oauth","date":"Apr 1, 2018","noPage":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/logic-app-microsoft-graph-oauth/"}}}